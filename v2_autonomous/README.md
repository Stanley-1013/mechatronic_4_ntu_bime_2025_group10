# v2 自主版本 (期末)

Arduino 負責即時沿牆控制，Pi 負責高階決策和視覺處理。

## 架構

```
┌─────────────────────────────────────────┐
│              Raspberry Pi               │
│  ┌─────────────┐  ┌──────────────────┐  │
│  │ 紅色辨識    │  │  高階狀態機      │  │
│  │ (OpenCV)    │  │  START/STOP/EXIT │  │
│  └─────────────┘  └──────────────────┘  │
└─────────────────────────────────────────┘
                    │ Serial (低頻事件)
                    ▼
┌─────────────────────────────────────────┐
│                Arduino                   │
│  ┌─────────────────────────────────────┐│
│  │      自主沿牆狀態機 (50-100Hz)      ││
│  │  IDLE / FORWARD / BACKUP / TURN     ││
│  │  - 超聲波感測器                     ││
│  │  - MPU6050 IMU                      ││
│  │  - P 控制沿牆                       ││
│  │  - 角落偵測 + 轉彎                  ││
│  └─────────────────────────────────────┘│
│                    │                    │
│                    ▼                    │
│  ┌─────────────────────────────────────┐│
│  │      馬達控制 (L298N)               ││
│  └─────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

## 通訊協定

### Pi → Arduino (事件驅動)

| 指令 | 值 | 說明 |
|------|-----|------|
| CMD_START | 0x01 | 開始自主沿牆 |
| CMD_STOP | 0x02 | 停止 |
| CMD_AVOID_RED | 0x03 | 避開紅色區域 |
| CMD_SET_VACUUM | 0x04 | 設定吸塵器 |

### Arduino → Pi (狀態回報)

| 資料 | 說明 |
|------|------|
| state | 當前狀態 |
| corner_count | 角落計數 |
| front_dist | 前方距離 |
| right_dist | 右側距離 |
| yaw | IMU 角度 |

## 優點

- 低延遲：沿牆控制在 Arduino 本地執行
- 穩定：無 Serial buffer 溢位問題
- Pi 專注視覺處理

---
*開發中 - 2025-12-02*
