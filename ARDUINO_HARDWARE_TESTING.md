# Arduino 硬體接線測試指南

本文件專門用於硬體組完成接線後的 Arduino 系統測試，確保所有硬體連接正確並正常運作。

## 目錄
1. [測試前準備](#測試前準備)
2. [接線確認清單](#接線確認清單)
3. [測試步驟](#測試步驟)
4. [常見問題排除](#常見問題排除)

---

## 測試前準備

### 所需硬體
- Arduino Uno/Nano 開發板
- L298N 馬達驅動模組 x1
- DC 馬達 x2（左輪、右輪）
- HC-SR04 超聲波感測器 x2（左側、右側）
- 吸塵器馬達模組 x1
- 電源供應（建議 7-12V，足夠電流）
- USB 連接線（Arduino 與電腦連接）

### 所需軟體
- Arduino IDE（1.8.x 或 2.x 版本）
- USB 驅動程式（CH340 或 FTDI，視 Arduino 型號而定）

### 程式上傳
1. 開啟 Arduino IDE
2. 載入 `arduino/main/main.ino`
3. 選擇正確的板子類型：工具 → 板子 → Arduino Uno/Nano
4. 選擇正確的 COM Port：工具 → 序列埠
5. 點擊「上傳」按鈕

---

## 接線確認清單

### 1. L298N 馬達驅動模組

#### 控制信號（Arduino → L298N）
| Arduino 腳位 | L298N 腳位 | 功能說明 |
|-------------|-----------|---------|
| D3 (PWM)    | ENA       | 左輪速度控制 |
| D5          | IN1       | 左輪方向 A |
| D6          | IN2       | 左輪方向 B |
| D11 (PWM)   | ENB       | 右輪速度控制 |
| D9          | IN3       | 右輪方向 A |
| D10         | IN4       | 右輪方向 B |

#### 電源連接
| L298N 腳位 | 連接對象 |
|-----------|---------|
| +12V      | 電源正極（7-12V） |
| GND       | 電源負極 + Arduino GND |
| +5V       | 可連接 Arduino 5V（若需供電）|

#### 馬達連接
| L298N 腳位 | 連接對象 |
|-----------|---------|
| OUT1, OUT2 | 左輪馬達 |
| OUT3, OUT4 | 右輪馬達 |

### 2. 超聲波感測器（HC-SR04）

#### 左側感測器
| Arduino 腳位 | HC-SR04 腳位 | 功能 |
|-------------|-------------|------|
| D7          | Trig        | 觸發 |
| D8          | Echo        | 回波 |
| 5V          | VCC         | 電源 |
| GND         | GND         | 接地 |

#### 右側感測器
| Arduino 腳位 | HC-SR04 腳位 | 功能 |
|-------------|-------------|------|
| A1          | Trig        | 觸發 |
| A2          | Echo        | 回波 |
| 5V          | VCC         | 電源 |
| GND         | GND         | 接地 |

### 3. 吸塵器馬達

| Arduino 腳位 | 連接對象 | 說明 |
|-------------|---------|------|
| D12         | 繼電器或電晶體控制腳位 | 控制吸塵器開關 |
| GND         | GND | 共地 |

### 4. Raspberry Pi 通訊（選配，純 Arduino 測試時不需要）

| Arduino 腳位 | Raspberry Pi GPIO | 功能 |
|-------------|------------------|------|
| D2 (TX)     | GPIO 15 (RXD)    | Arduino 發送 |
| D4 (RX)     | GPIO 14 (TXD)    | Arduino 接收 |
| GND         | GND              | 共地 |

---

## 測試步驟

### 測試 1：基本連接測試

1. **上傳程式後開啟序列埠監控視窗**
   - 工具 → 序列埠監控視窗
   - 設定鮑率：115200
   - 設定行結尾：換行（Newline）

2. **檢查啟動訊息**
   應該看到類似以下訊息：
   ```
   ========================================
   Arduino 機器人控制系統 v1.0
   ========================================
   [初始化] 馬達驅動...完成
   [初始化] 超聲波感測器...完成
   [初始化] 吸塵器控制...完成
   [初始化] 序列通訊 (57600 bps)...完成
   [系統] 準備就緒，等待指令...
   ========================================
   ```

3. **如果沒有訊息出現**
   - 檢查鮑率是否為 115200
   - 檢查 USB 連接是否穩固
   - 嘗試按下 Arduino 的 Reset 按鈕

### 測試 2：超聲波感測器測試

1. **觀察感測器數據**
   序列埠監控視窗應該每 100ms 顯示一次感測器數據：
   ```
   [感測器] 左側: 25cm | 右側: 30cm
   ```

2. **手動測試感測器**
   - 在左側感測器前方放置障礙物（如手掌或書本）
   - 距離應該隨著障礙物移動而改變
   - 重複測試右側感測器

3. **預期結果**
   - 測量範圍：2cm ~ 400cm
   - 誤差範圍：±1cm
   - 無障礙物時可能顯示 0cm 或最大值

4. **如果感測器無反應**
   - 檢查 VCC 和 GND 是否正確連接
   - 檢查 Trig 和 Echo 腳位是否接對
   - 確認感測器前方無遮擋物

### 測試 3：馬達驅動測試

**⚠️ 安全提醒：測試前請將機器人架高，確保輪子不接觸地面！**

#### 3.1 手動指令測試

在序列埠監控視窗輸入以下指令（每次輸入一行後按 Enter）：

1. **前進測試**
   ```
   M150,150
   ```
   - 兩個輪子應該同時正轉
   - 速度：150/255（約 60%）

2. **後退測試**
   ```
   M-150,-150
   ```
   - 兩個輪子應該同時反轉

3. **左轉測試**
   ```
   M-100,100
   ```
   - 左輪反轉，右輪正轉

4. **右轉測試**
   ```
   M100,-100
   ```
   - 左輪正轉，右輪反轉

5. **停止測試**
   ```
   M0,0
   ```
   - 兩個輪子應該停止

#### 3.2 速度測試

測試不同速度檔位：
```
M50,50      # 低速
M150,150    # 中速
M255,255    # 全速
M0,0        # 停止
```

#### 3.3 預期結果

- 序列埠監控視窗應顯示：
  ```
  [指令] 馬達: L=150, R=150
  ```
- 馬達應該平順運轉，無異常噪音
- 方向應與指令一致

#### 3.4 馬達問題排除

| 問題現象 | 可能原因 | 解決方法 |
|---------|---------|---------|
| 馬達完全不轉 | 電源未接 | 檢查 L298N 電源接線 |
| 馬達只會單向轉 | IN1-IN4 接線錯誤 | 檢查方向控制腳位 |
| 馬達無力 | PWM 腳位接錯 | 確認 ENA/ENB 接在 PWM 腳位 |
| 馬達轉向相反 | 馬達線接反 | 交換 OUT1/OUT2 或 OUT3/OUT4 |
| 左右輪速度差異大 | 馬達特性不同 | 需在程式中校正（未來調整） |

### 測試 4：吸塵器馬達測試

1. **開啟吸塵器**
   ```
   V1
   ```
   - 吸塵器應該啟動
   - 序列埠顯示：`[指令] 吸塵器: ON`

2. **關閉吸塵器**
   ```
   V0
   ```
   - 吸塵器應該停止
   - 序列埠顯示：`[指令] 吸塵器: OFF`

3. **如果吸塵器無反應**
   - 檢查 D12 腳位接線
   - 檢查繼電器或電晶體驅動電路
   - 確認吸塵器電源供應正常

### 測試 5：綜合功能測試

執行一系列動作組合：

```
M150,150    # 前進
(等待 2 秒)
M0,0        # 停止
V1          # 開啟吸塵器
M-100,100   # 左轉
(等待 1 秒)
M0,0        # 停止
V0          # 關閉吸塵器
```

觀察：
- 所有動作應該流暢執行
- 感測器數據持續更新
- 無程式當機或重置現象

---

## 常見問題排除

### 問題 1：Arduino 無法上傳程式

**症狀**：上傳時出現 `avrdude: stk500_recv(): programmer is not responding`

**解決方法**：
1. 確認選擇正確的板子類型
2. 確認選擇正確的 COM Port
3. 嘗試按住 Reset 按鈕，點擊上傳後立即放開
4. 檢查 USB 線材是否支援資料傳輸（不是只有充電功能）
5. 重新安裝 USB 驅動程式

### 問題 2：序列埠監控視窗顯示亂碼

**解決方法**：
1. 確認鮑率設定為 115200
2. 按下 Arduino 的 Reset 按鈕重新啟動
3. 檢查 USB 連接穩定性

### 問題 3：感測器數據一直顯示 0cm

**可能原因**：
1. Echo 腳位未正確連接
2. 感測器電源不足
3. 感測器損壞

**解決方法**：
1. 用三用電表測量感測器 VCC（應為 5V）
2. 檢查 Echo 腳位接線
3. 更換感測器測試

### 問題 4：馬達轉動抖動或無力

**可能原因**：
1. 電源供應不足
2. L298N 散熱不良
3. 馬達負載過重

**解決方法**：
1. 使用更大容量的電源（建議至少 2A）
2. 為 L298N 加裝散熱片
3. 減輕機器人重量或降低速度

### 問題 5：指令無反應

**症狀**：輸入 `M150,150` 但馬達不轉

**解決方法**：
1. 確認序列埠監控視窗的行結尾設定為「換行」
2. 檢查指令格式是否正確（大小寫、逗號）
3. 查看除錯訊息是否有錯誤提示
4. 嘗試按 Reset 重新啟動

### 問題 6：Raspberry Pi 通訊失敗（選配功能）

**症狀**：Arduino 無法接收 Raspberry Pi 的指令

**解決方法**：
1. 確認 TX/RX 交叉連接（Arduino TX → Pi RX，Arduino RX → Pi TX）
2. 確認共地（GND）連接
3. 確認鮑率設定一致（57600）
4. 檢查 SoftwareSerial 腳位定義（D2, D4）
5. 暫時使用 USB 序列埠測試（排除 Pi 因素）

---

## 測試完成檢查清單

完成以下所有項目才算測試通過：

- [ ] Arduino 程式成功上傳
- [ ] 序列埠監控視窗顯示啟動訊息
- [ ] 左側超聲波感測器數據正常
- [ ] 右側超聲波感測器數據正常
- [ ] 馬達可前進（正轉）
- [ ] 馬達可後退（反轉）
- [ ] 馬達可左轉
- [ ] 馬達可右轉
- [ ] 馬達可停止
- [ ] 吸塵器可開啟
- [ ] 吸塵器可關閉
- [ ] 所有功能組合運作正常
- [ ] 無異常噪音或發熱

---

## 下一步

測試通過後，可以進行：

1. **整合測試**：連接 Raspberry Pi，測試整體系統
2. **校正調整**：根據實際情況調整馬達速度、感測器參數
3. **功能擴展**：加入更多感測器或控制邏輯

詳細說明請參考：
- [QUICK_START.md](QUICK_START.md) - 快速上手指南
- [TESTING_GUIDE.md](TESTING_GUIDE.md) - 完整測試指南
- [DEPLOYMENT_GUIDE.md](DEPLOYMENT_GUIDE.md) - 部署指南

---

## 技術支援

如遇到無法解決的問題，請記錄：
1. 問題現象（文字描述 + 照片）
2. 接線照片
3. 序列埠監控視窗的輸出訊息
4. 已嘗試的解決方法

並聯繫硬體組或軟體組協助排查。
