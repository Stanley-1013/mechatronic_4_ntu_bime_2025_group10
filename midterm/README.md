# 期中階段成果總覽

**階段目標：** 完成遙控模式基礎系統
**測試日期：** 2025-11-14
**狀態：** ✅ 已完成

---

## 一、階段概述

本期中階段成功開發並測試了一套基於 **Raspberry Pi 4** 和 **Arduino Uno** 的雙控制器遙控車系統。系統整合了 2.4G 無線遙控、差動驅動馬達控制、吸塵器功能與即時影像串流，達到預期目標。

### 核心成就
- **2.4G 無線遙控操作** - USB GamePad 即插即用
- **差動驅動控制** - 數學模型清晰，操控流暢
- **穩定通訊機制** - 通過 Serial 多重驗證，無中斷運行
- **完整軟體棧** - Python 上位機 + Arduino 底層驅動
- **詳盡文檔** - 5 份軟工設計文檔 + 操作指南

---

## 二、系統架構

```
┌─────────────────┐
│  2.4G 遙控器    │
│  (USB 接收器)   │
└────────┬────────┘
         │ USB
┌────────▼────────────────────────┐
│   Raspberry Pi 4                │
│                                 │
│  • Python 控制程式              │
│  • 遙控訊號處理                 │
│  • 差動驅動運算                 │
│  • 影像串流 (OpenCV + mjpg)     │
└────────┬────────────────────────┘
         │ USB Serial (9600 baud)
┌────────▼────────────────────────┐
│   Arduino Uno                   │
│                                 │
│  • 馬達 PWM 控制                │
│  • 繼電器控制                   │
│  • Serial 通訊處理              │
└────────┬────────────────────────┘
         │
    ┌────┴────┬──────────┬─────────┐
    ▼         ▼          ▼         ▼
 L298N    左輪馬達    右輪馬達   繼電器
                                  (吸塵器)
```

### 硬體配置

| 元件 | 型號/規格 | 用途 |
|------|----------|------|
| 主控板 | Raspberry Pi 4 | 高階控制、影像處理 |
| 微控制器 | Arduino Uno | 底層馬達控制 |
| 馬達驅動 | L298N H-Bridge | 雙馬達 PWM 驅動 |
| 遙控器 | 2.4G USB GamePad | 無線控制 |
| 相機 | USB Camera | 即時影像串流 |
| 繼電器 | 單路繼電器 | 吸塵器開關 |

---

## 三、期中成果

### 3.1 功能達成

| 功能 | 狀態 | 說明 |
|------|------|------|
| 遙控器連接 | ✅ 正常 | USB 接收器即插即用 |
| 前進/後退 | ✅ 正常 | 響應靈敏，速度可控 |
| 左轉/右轉 | ✅ 正常 | 轉向準確，可原地旋轉 |
| 雙搖桿同時操作 | ✅ 正常 | 可邊前進邊轉向 |
| 吸塵器開關 | ✅ 正常 | Toggle 邏輯正確 |
| 長時間運行 | ✅ 正常 | 無 timeout 或卡頓 |
| 影像串流 | ✅ 正常 | 即時影像流暢 |

### 3.2 技術亮點

#### 1. 模組化設計
- 單一職責原則，清晰的分層架構
- Raspberry Pi 端 5 個獨立模組（控制、通訊、驅動、遙控輸入、影像）
- Arduino 端 3 個模組化驅動（馬達、繼電器、通訊）
- 易於測試與維護

#### 2. 穩定的通訊機制
- **8-byte 二進位封包** - 定長易解析
- **多重驗證** - Header (0xAA) + Footer (0x55) + XOR Checksum
- **防阻塞設計** - Serial timeout + 緩衝區保護
- **無損傳輸** - 通過期間無單筆指令遺失

#### 3. 精確的差動驅動
```
left_speed = linear_velocity - angular_velocity
right_speed = linear_velocity + angular_velocity
```
- 數學模型簡潔直觀
- 支援同時前進+轉向
- 控制平順自然，無突兀跳躍

#### 4. 完整的錯誤處理
- Serial timeout 保護（避免永久阻塞）
- 緩衝區溢出檢測
- 看門狗機制（超時自動停止）
- 運行時長超過 1 小時無故障

#### 5. 詳盡的技術文檔
- 5 份軟體工程設計文檔
- 部署、測試、除錯、操作、架構說明指南
- 程式碼註解清晰，易於後續維護

---

## 四、問題與解決

| 問題 | 現象 | 原因 | 解決方案 | 成果 |
|------|------|------|---------|------|
| Serial 通訊阻塞 | 運行 7 秒後 timeout | 9600 baud 頻寬飽和（50Hz 發送 + DEBUG 輸出） | 降頻至 20Hz、關閉 DEBUG、加入 timeout 保護 | 系統穩定運行，無 timeout |
| 硬體腳位不匹配 | 馬達不動或方向錯誤 | 實際接線與文檔假設不同 | 逐一測試修正腳位配置 | 馬達控制正常 |
| 超聲波感測器干擾 | 加入感測器後 timeout 持續 | 30-40ms 阻塞操作堵塞 Serial | 暫停感測器，改用非阻塞方案 | 待期末實現 |

---

## 五、軟體工程文件

本專案包含 **5 份完整的軟體工程設計文檔**，符合高端工程規範：

| 文件 | 版本 | 說明 |
|------|------|------|
| [01_SRS 軟體需求規格書](docs/01_SRS_軟體需求規格書.md) | 1.1 | 功能與非功能需求、系統邊界、使用案例 |
| [02_SA 系統分析](docs/02_SA_系統分析.md) | 1.1 | 用例圖、活動圖、狀態圖 |
| [03_SD 系統設計](docs/03_SD_系統設計.md) | 1.0 | 類別圖、序列圖、部署架構 |
| [04_ICD 介面規格](docs/04_ICD_介面規格.md) | 3.0 | Serial 通訊協定、封包格式、狀態機 |
| [05_TDD 測試計畫](docs/05_TDD_測試計畫.md) | 1.0 | 測試策略、測試案例、驗收條件 |

這些文檔不只是交件用途，而是實際指導開發與驗證的工程規範。

---

## 六、目錄結構

```
midterm/
├── README.md                           # 本文件
├── MIDTERM_REPORT.md                   # 詳細技術報告
├── DEVELOPMENT_GUIDE.md                # 開發與測試指南
├── docs/                               # 軟體工程文檔
│   ├── 01_SRS_軟體需求規格書.md
│   ├── 02_SA_系統分析.md
│   ├── 03_SD_系統設計.md
│   ├── 04_ICD_介面規格.md
│   └── 05_TDD_測試計畫.md
└── v1_remote_control/                  # 遙控版本源程式碼
    ├── README.md
    ├── arduino/
    │   ├── main/
    │   │   └── main.ino
    │   └── test_ultrasonic_a1a2/
    │       └── test_ultrasonic_a1a2.ino
    └── raspberry_pi/
        ├── main.py                     # 遙控主程式
        ├── config.py                   # 系統參數設定
        ├── robot_controller.py         # 控制邏輯
        ├── arduino_controller.py       # Serial 通訊
        ├── usb_24g_receiver.py         # 遙控輸入
        ├── differential_drive.py       # 差動驅動演算法
        ├── test_joystick.py
        ├── test_motor_only.py
        └── requirements.txt
```

### 關鍵檔案說明

| 檔案 | 行數 | 用途 |
|------|------|------|
| `v1_remote_control/raspberry_pi/main.py` | ~200 | 遙控模式主程式入口 |
| `v1_remote_control/arduino/main/main.ino` | ~300 | Arduino 底層驅動 |
| `MIDTERM_REPORT.md` | ~400 | 完整技術報告 |
| `DEVELOPMENT_GUIDE.md` | ~660 | 部署、測試、除錯指南 |

---

## 七、後續發展

### 期末階段規劃

本期中成果為自主避障與路徑規劃奠定穩固基礎：

1. **超聲波非阻塞式讀取** - 恢復距離感測功能
2. **IMU 融合定位** - 集成 MPU6050 角度追蹤
3. **自主避障演算法** - PD 控制 + 狀態機決策
4. **路徑記錄與回放** - Waypoint 導航
5. **Web 遠端監控** - 即時狀態儀表板

→ 詳見期末階段規劃（待整合）

---

## 八、團隊與參考

**團隊：** NTU BIME 2025 Group 10
**報告日期：** 2025-11-19
**文檔版本：** 1.0 (2025-12-13)

### 快速入門
- 詳細開發指南：[DEVELOPMENT_GUIDE.md](DEVELOPMENT_GUIDE.md)
- 技術深度報告：[MIDTERM_REPORT.md](MIDTERM_REPORT.md)
- 源程式碼：[v1_remote_control/](v1_remote_control/)

---

**期中階段目標達成，系統運作穩定，為期末功能擴展奠定良好基礎。** ✅
